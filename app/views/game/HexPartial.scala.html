@import models.game._

@(game: Game, userId: String, gameOver: Boolean = false)

@stroke(borders: Seq[Int], color: String)= @{

def getVectors(width: Double): (Double, Double) = {
(width * 0.5, width * 0.875)
}

val pixels = 2.25
val blur = 0.5
val (right, down) = getVectors(pixels)

val bCss = Map(
    //    r   d   b   color
    1 -> s"-${pixels}px 0px ${blur}px #000",
    2 -> s"-${right}px -${down}px ${blur}px #000",
    3 -> s"${right}px -${down}px ${blur}px #000",
    4 -> s"${pixels}px 0px ${blur}px #000",
    5 -> s"${right}px ${down}px ${blur}px #000",
    6 -> s"-${right}px ${down}px ${blur}px #000"
)
    val cCss = Map(
    //    r   d   b   color
    1 -> s"-${pixels}px 0px ${blur}px $color",
    2 -> s"-${right}px -${down}px ${blur}px $color",
    3 -> s"${right}px -${down}px ${blur}px $color",
    4 -> s"${pixels}px 0px ${blur}px $color",
    5 -> s"${right}px ${down}px ${blur}px $color",
    6 -> s"-${right}px ${down}px ${blur}px $color"
    )

    val notBorders = Seq(1, 2, 3, 4, 5, 6).filterNot(borders.contains)

    (notBorders.map(cCss) ++ borders.map(bCss)).mkString("text-shadow: ", ", ", "")
}

@getColor(player: Int) = @{
    player match{
        case 1 => "green"
        case 2 => "red"
        case 3 => "orange"
        case 4 => "blue"
        case 5 => "magenta"
        case 6 => "LightSlateGray"
        case 7 => "Gold"
        case 8 => "NavajoWhite"
        case 9 => "RosyBrown"
        case _ => "limegreen"
    }
}
@turnStyle(isTurn: Boolean, stillIn: Boolean) = @{
    if (isTurn) "border-radius: 12px;border: 2px solid green;"
    else if (!stillIn) "text-decoration: line-through;"
    else ""
}

@territoryClasses(player: Player, territory: Territory) = @{
    Seq(
        Some("cursorPoint"),
        Some("borderParent").filter(_ => game.rightPlayer(userId) && (territory.belongsTo(player) || player.clickedTerritoryId.flatMap(game.getTerritoryById).exists(_.attackable(game.boardState.toSet).contains(territory)))),
        Some("clickedTerritory").filter(_ => player.clickedTerritoryId.contains(territory.id))
    ).collect{case Some(clazz) => clazz}.mkString(" ")
}

@territoryClassesOnClick(player: Player, territory: Territory) = @{
    if(game.rightPlayer(userId)){
        if(territory.belongsTo(player) && territory.diceCount > 1) {
            s"sendMessage('click-mine-${territory.id}')"
        } else if (player.clickedTerritoryId.isDefined && player.clickedTerritoryId.flatMap(game.getTerritoryById).exists(_.attackable(game.boardState.toSet).contains(territory))){
            s"sendMessage('click-theirs-${territory.id}')"
        } else "null"
    } else "null"
}

@if(gameOver){
    <h1>GAME OVER</h1>
}
<div style="overflow: hidden;">
    <div class="boardWrapper aztec">
        @game.boardState.map{ territory =>
            <span class="@territoryClasses(game.thisTurn, territory)" style="color: @{getColor(territory.player)}" onclick="@territoryClassesOnClick(game.thisTurn, territory)">
                <div style="top:@{territory.topPx}vw;left:@{territory.leftPx}vw;position: absolute;z-index:100;font-size:3vw;padding-left:1vw;color: black;background-color:white;" >@territory.diceCount</div>
                @territory.hexes.map{ hex: Hex =>
                    <div class="borderChild" style="top:@{hex.topPx}vw;left:@{hex.leftPx}vw;position: absolute; font-size:3vw;padding-left:0.5vw;@stroke(hex.needsBorder(territory.hexes), getColor(territory.player));">
                        &#x2B22;
                    </div>
                }
            </span>
        }
    </div>
    <div class="infoTabWrapper">
            <div style="width:100%;display: table;">
                    <span style="display: table-cell;text-align: center;color:grey">@userId</span>
                    <span style="display: table-cell;text-align: center;color:grey">Turn: @{game.turn}</span>
            </div>
            <div style="height: 2em;width:100%;">
                @if(game.rightPlayer(userId)){It's your turn!}
            </div>

                @game.turnStatus.map{ case (player, isTurn, stillIn, largestUnitedTerritoryCount) =>
                    <div style="width: 80%;@turnStyle(isTurn, stillIn);display: table;">
                        <span style="padding-left:1vw;color: @{getColor(player.number)};display: table-cell">&#x2B22;</span>
                        <span style="padding-left:1vw;max-width:30%;display: table-cell;">@player.number</span>
                        <span style="padding-left:1vw;max-width:30%;display: table-cell;">@player.userName</span>
                        <span style="padding-left:1vw;display: table-cell;">@largestUnitedTerritoryCount.size</span>
                    </div>
                }

            <div id="button-box" style="width:16vw; height:3vw;margin: 0 auto;padding: 10px;position: relative;">
                @if(game.rightPlayer(userId) && !gameOver) {
                    <p>1. Click your area. 2. Click neighbor to attack</p>

                    <div class="endTurn" onclick="sendMessage('end-turn')">
                        End turn
                    </div>
                }
            </div>
    </div>
</div>

